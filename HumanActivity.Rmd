---
title: "Weight Lifting"
output: html_document
---

This prediction assignment classifies how well the unilateral dumbbell biceps Curl was performed. Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now possible to collect a large amount of data about personal activity relatively inexpensively. One thing that people regularly do is quantify how much of a particular activity they do, but they rarely quantify how well they do it.

Six young health participants were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E).

Read more: http://groupware.les.inf.puc-rio.br/har#ixzz3YNOedxSj

```{r,echo=FALSE}
setwd("C:/Users/ruoyang/My Documents/Coursera/Data Science/")
```

1. Load packages and data sets
Download the training and testing data sets and save them in the working directory.
```{r}
library(caret)
training<-read.csv("pml-training.csv", na.strings=c("NA",""))
testing<-read.csv("pml-testing.csv", na.strings=c("NA",""))
```

2. Pre-processing
Looking at the column names, the first seven columns of the training set contain non-predictors, such as index number, user name and time stamps. Therefore, one can remove these non-predictor fields from the training set.
```{r}
training$X<-NULL
training$user_name<-NULL
training$raw_timestamp_part_1<-NULL
training$raw_timestamp_part_2<-NULL
training$cvtd_timestamp<-NULL
training$new_window<-NULL
training$num_window<-NULL
dim(training)
```

Also, it is important to remove missing values.
In this first approach, we only keep rows of data where no missing value is found in any columns.
```{r}
tidy_train<-training[complete.cases(training), ]
dim(tidy_train)
```
However, this approach leaves us with a very small data size, which might negatively affect our model building.

Let's try another approach, we will remove columns in which missing values account for more than 85% of the data.
```{r}
NAcount<-colSums(is.na(training))
tidy_train<-training[NAcount<17000]
dim(tidy_train)
which(colSums(is.na(tidy_train))>0)
```
Now the new training data set no longer contains NAs.

Likewise, we will pre-process the testing data set in the same manner.
```{r}
excl<-which(colnames(testing) %in% c("X","user_name","raw_timestamp_part_1","raw_timestamp_part_2","cvtd_timestamp","new_window","num_window"))
testing=testing[, -excl]
NAcount1<-colSums(is.na(testing))
tidy_test<-testing[NAcount<17000]
tidy_test$classe<-testing$classe
dim(tidy_test)
```

However, we see that the testing set does not contain the "classe" column. Thus we cannot calculate the out of sample accuracy. We can therefore split the original training set into a 70% training and 30% validation sets.
```{r}
inTrain<-createDataPartition(y=tidy_train$classe,p=0.7,list=FALSE)
trainData<-tidy_train[inTrain,]
valData<-tidy_train[-inTrain,]
```

3. Model Building
We can build a random forest model using the randomForest package with default nodesize and ntree parameters.
```{r}
library(randomForest)
rf=randomForest(classe~., data=trainData, nodesize=25, ntree = 500)
rf
trainPred=predict(rf, newdata=trainData)
confusionMatrix(trainPred,trainData$classe)
```
The model is 99.6% accurate in making in-sample predictions.

4. Out of sample accuracy on validation set
Using the random forest model on the validation set, we can assess the prediction accuracy on data that wasn't used to build our model.
```{r}
trainPred=predict(rf, newdata=valData)
confusionMatrix(trainPred,valData$classe)
```
Our prediction accuracy using the random forest model is 98.6% on the validation set.

4. Prediction Submission
```{r}
answers=predict(rf, newdata=tidy_test)
answers <- as.character(answers)
answers
pml_write_files = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}
pml_write_files(answers)
```
